
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.3">
    
    
      
        <title>Deploy heroku walkthrough - Helios server notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  <script defer src="https://umami.wrmack.com/script.js" data-website-id="46ca91ae-3dba-41a1-bcde-b4b378ed1a6e"></script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#caveats" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Helios server notes" class="md-header__button md-logo" aria-label="Helios server notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Helios server notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deploy heroku walkthrough
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/wrmack/helios-server-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Helios server notes" class="md-nav__button md-logo" aria-label="Helios server notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Helios server notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/wrmack/helios-server-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inst_env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment essentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inst_auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inst_django/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prepare Django
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inst_dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local development
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inst_ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Walk-through with Ubuntu
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy_aws_walkthrough/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS walk-through
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Secure elections
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Secure elections
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../con_e2ev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verifiability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../con_coercion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coercion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_simple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple encryption
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sec_helios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helios cryptography
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How Helios works
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            How Helios works
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref_literature/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Academic papers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../privacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Privacy
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    <span class="md-ellipsis">
      Caveats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-heroku" class="md-nav__link">
    <span class="md-ellipsis">
      About Heroku
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    <span class="md-ellipsis">
      Assumptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-web-app-to-run-the-helios-server-on-heroku-by-using-heroku-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Create a web app to run the Helios server on Heroku by using Heroku dashboard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-helios-server-for-deployment-to-heroku" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing helios server for deployment to Heroku
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-by-using-the-heroku-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy by using the Heroku dashboard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email" class="md-nav__link">
    <span class="md-ellipsis">
      Email
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Deploy heroku walkthrough</h1>

<p>Deploying Helios to Heroku.</p>
<h2 id="caveats">Caveats</h2>
<p>I put this walk-through together when Heroku had a free tier. From November 2022 <a href="https://blog.heroku.com/next-chapter">Heroku no longer has a free tier</a> and I have removed my apps.  Therefore I have not tested this deployment recently under the new arrangements.  </p>
<p>Also, it has not been tested with a real election.  </p>
<p>However the walk-through might help to get you started.</p>
<h2 id="about-heroku">About Heroku</h2>
<p>Heroku is a subsidiary of salesforce.com. Its servers are hosted on Amazon's EC2 cloud-computing platform.</p>
<p>When an app is deployed it runs in a container called a ‘dyno’.  There is no direct access to its filesystem.  There is more about dynos <a href="https://www.heroku.com/dynos">here</a>.</p>
<p><strong>Deployment</strong></p>
<p>There are options for deploying an app.  One option is to link to a Github repository so that a push to Github triggers a build and deployment.</p>
<p><strong>Configuration</strong></p>
<p>There is one required configuration file - Procfile.  This tells Heroku what to run when an app is deployed.  I use the following for running one web server process and one Celery worker process:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>web: gunicorn wsgi
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>worker: celery worker -A helios -l info
</span></code></pre></div>
<p><strong>Building and debugging</strong></p>
<p>Build logs can be viewed through Heroku’s web interface, but for anything more than that it is important to become familiar with the Heroku CLI application.  Heroku CLI can also run a psql shell for examining the database. Run this for a real-time display of logs generated on the Heroku site (if helios-heroku is the name of your app on Heroku):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>heroku logs --tail -a helios-heroku
</span></code></pre></div>
<p><strong>Helios requirements</strong></p>
<p>For tasks, Celery may be used and there are options for a broker (for example Redis).</p>
<p>For sending email, an add-on, <a href="https://elements.heroku.com/addons/sendgrid">SendGrid</a>, can be used. This is free up to 12,000 emails per month. </p>
<h2 id="assumptions">Assumptions</h2>
<ul>
<li>helios server is installed locally</li>
<li>helios server is managed through git</li>
<li>helios server has a remote repository on Github</li>
<li>you have created an account on Heroku and are logged in</li>
<li>you have downloaded and installed <a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku CLI</a> which we will use for accessing the database.</li>
</ul>
<h2 id="create-a-web-app-to-run-the-helios-server-on-heroku-by-using-heroku-dashboard">Create a web app to run the Helios server on Heroku by using Heroku dashboard</h2>
<ul>
<li>go to <a href="https://dashboard.heroku.com">https://dashboard.heroku.com</a></li>
<li>go to New - <strong>Create new app</strong></li>
<li>give it a name and click <strong>Create app</strong></li>
<li>you should now be in the "Deploy" tab</li>
<li>for "Deployment method" select <strong>Github</strong></li>
<li>for "Connect to Github" enter your repository name eg helios-server</li>
<li>when Heroku has found your Github repository it will list it with a Connect button alongside</li>
<li>click <strong>Connect</strong></li>
<li>your app name is referred to below as <strong>APPNAME</strong> - substitute the actual name you gave it</li>
</ul>
<h2 id="preparing-helios-server-for-deployment-to-heroku">Preparing helios server for deployment to Heroku</h2>
<ul>
<li>Heroku requires a Procfile - create a file <code>Procfile</code> with the following content
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>web:<span class="w"> </span>gunicorn<span class="w"> </span>wsgi:application<span class="w"> </span>-b<span class="w"> </span><span class="m">0</span>.0.0.0:<span class="nv">$PORT</span><span class="w"> </span>-w<span class="w"> </span><span class="m">8</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>worker:<span class="w"> </span>celery<span class="w"> </span>worker<span class="w"> </span>--app<span class="w"> </span>helios<span class="w"> </span>--events<span class="w"> </span>--beat<span class="w"> </span>--concurrency<span class="w"> </span><span class="m">1</span>
</span></code></pre></div></li>
<li>you may go to <a href="#deploy-by-using-the-heroku-dashboard">"Deploy by using the Heroku dashboard"</a> below at any time to examine error messages and comfirm whether you need to do the following.</li>
</ul>
<p><strong>Secret environment variables</strong> (such as passwords)</p>
<ul>
<li>secrets need to be passed to Heroku as environment variables when you set up your Heroku app (so they are not visible in any files you have on Github)</li>
<li>if you added a <code>.env</code> file and imported <code>environ</code> into <code>settings.py</code> for local development, remove them for deployment to Heroku</li>
<li>go to the <strong>Settings</strong> tab on Heroku's dashboard page for your app and select <strong>Reveal Config Vars</strong></li>
<li>add your authentication credentials, eg in <code>settings.py</code> you might have:</li>
</ul>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">          </span><span class="nv">GOOGLE_CLIENT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;GOOGLEID&#39;</span><span class="o">]</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">          </span><span class="nv">GOOGLE_CLIENT_SECRET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;GOOGLESECRET&#39;</span><span class="o">]</span><span class="w">       </span>
</span></code></pre></div>
in which case you would add the keys GOOGLEID and GOOGLESECRET as 'config vars' and enter the appropriate values for each.</p>
<ul>
<li>make sure that in <a href="https://console.developers.google.com/apis/credentials">Google console</a> you enter the correct uris: </li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">    </span><span class="c1"># Authorised JavaScript origins</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span>https://APPNAME.herokuapp.com
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="c1">#Authorised redirect URIs</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span>https://APPNAME.herokuapp.com/auth/after/
</span></code></pre></div>
<p><strong>Settings</strong></p>
<ul>
<li>other changes in <code>settings.py</code>:<ul>
<li>add the Heroku host to the ALLOWED_HOSTS array
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nv">ALLOWED_HOSTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;APPNAME.herokuapp.com&#39;</span><span class="o">]</span>
</span></code></pre></div></li>
<li>for URL_HOST add the Heroku url (it will automatically be used for the SECURE_URL_HOST)
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">URL_HOST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>get_from_env<span class="o">(</span><span class="s2">&quot;URL_HOST&quot;</span>,<span class="w"> </span><span class="s2">&quot;https://APPNAME.herokuapp.com&quot;</span><span class="o">)</span>.rstrip<span class="o">(</span><span class="s2">&quot;/&quot;</span><span class="o">)</span>
</span></code></pre></div></li>
<li>database settings should be:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">    </span><span class="nv">DATABASES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">      </span><span class="s1">&#39;default&#39;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">          </span><span class="s1">&#39;ENGINE&#39;</span>:<span class="w"> </span><span class="s1">&#39;django.db.backends.postgresql_psycopg2&#39;</span>,
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">          </span><span class="s1">&#39;NAME&#39;</span>:<span class="w"> </span><span class="s1">&#39;helios&#39;</span>,
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">          </span><span class="s1">&#39;CONN_MAX_AGE&#39;</span>:<span class="w"> </span><span class="m">600</span>,
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="o">}</span>,
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="c1"># override if we have an env variable</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>get_from_env<span class="o">(</span><span class="s1">&#39;DATABASE_URL&#39;</span>,<span class="w"> </span>None<span class="o">)</span>:
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">      </span>import<span class="w"> </span>dj_database_url
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">      </span>DATABASES<span class="o">[</span><span class="s1">&#39;default&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>dj_database_url.config<span class="o">(</span><span class="nv">conn_max_age</span><span class="o">=</span><span class="m">600</span>,<span class="w"> </span><span class="nv">ssl_require</span><span class="o">=</span>True<span class="o">)</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">      </span>DATABASES<span class="o">[</span><span class="s1">&#39;default&#39;</span><span class="o">][</span><span class="s1">&#39;ENGINE&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;django.db.backends.postgresql_psycopg2&#39;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Celery</strong></p>
<ul>
<li>Celery requires a process worker - we will use CloudAMQP which is available as a Heroku add-on</li>
<li>on the Heroku dashboard page for your app go to the <strong>Resources</strong> tab and select <strong>Find more add-ons</strong></li>
<li>under <strong>Add-on categories</strong> go to <strong>Messaging and Queuing</strong></li>
<li>select <strong>CloudAMQP</strong></li>
<li>under <strong>Plans &amp; Pricing</strong> select <strong>Little Lemur</strong> (the free option) and <strong>Install CloudAMQP</strong></li>
<li>to provision the add-on for your app enter the name of your app and click <strong>Submit Order Form</strong></li>
<li>check it has been added by going to the <strong>Settings</strong> page  - Config Vars should now include a key CLOUDAMQP_URL</li>
<li>on the <strong>Resources</strong> page switch on celery worker if it is not already</li>
<li>in <code>settings.py</code> add:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nv">CELERY_BROKER_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;CLOUDAMQP_URL&#39;</span><span class="o">]</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nv">BROKER_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;CLOUDAMQP_URL&#39;</span><span class="o">]</span>
</span></code></pre></div></li>
</ul>
<p><strong>Dependencies</strong></p>
<ul>
<li>Heroku loads all dependencies that are in <code>requirements.txt</code></li>
<li>if, in your local version of Helios, you loaded any dependency separately to what is in <code>requirements.txt</code> Heroku will not know about it, so put it in <code>requirements.txt</code>.</li>
</ul>
<p><strong>Collectstatic</strong></p>
<ul>
<li>by default, Heroku runs <code>python manage.py collectstatic</code> which we don't need so disable it:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>heroku<span class="w"> </span>config:set<span class="w"> </span><span class="nv">DISABLE_COLLECTSTATIC</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
</span></code></pre></div></li>
</ul>
<h2 id="deploy-by-using-the-heroku-dashboard">Deploy by using the Heroku dashboard</h2>
<ul>
<li>commit all your changes and push to Github</li>
<li>in Heroku dashboard for your app, in the <strong>Deploy</strong> tab, if you haven't set <strong>Enable Automatic Deploys</strong>, next to <strong>Manual deploy</strong> select the branch you want to deploy and click <strong>Deploy branch</strong></li>
<li>Heroku will attempt to install your helios server web app and it displays a log as it does this</li>
<li>if it installs successfully Heroku will launch it</li>
<li>click <strong>Open app</strong> at the top of the page to view your web page</li>
<li>if launching fails, examine logs in a terminal with
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>heroku<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span>--app<span class="w"> </span>APPNAME
</span></code></pre></div></li>
<li>there will be an error message because we have not set up the Postgreslq database yet.</li>
</ul>
<p><strong>Database</strong></p>
<ul>
<li>Heroku should have attached a Postgresql database to your app and created the 'helios' database in line with your database settings in <code>settings.py</code></li>
<li>create a Heroku shell and populate the 'helios' database
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>heroku<span class="w"> </span>run<span class="w"> </span>bash<span class="w"> </span>--app<span class="w"> </span>APPNAME
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>~<span class="w"> </span>$<span class="w"> </span>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>~<span class="w"> </span>$<span class="w"> </span>python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>~<span class="w"> </span>$<span class="w"> </span><span class="nb">exit</span>
</span></code></pre></div></li>
<li>check database tables have been created:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>heroku<span class="w"> </span>pg:psql<span class="w"> </span>--app<span class="w"> </span>APPNAME
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>APPNAME::DATABASE<span class="o">=</span>&gt;<span class="w"> </span><span class="se">\d</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>APPNAME::DATABASE<span class="o">=</span>&gt;<span class="w"> </span><span class="se">\q</span>
</span></code></pre></div></li>
<li>(optional) open your app again, or refresh it if it is already open in your browser - it should run this time, but you should be able to create an election but cannot yet send emails.</li>
</ul>
<h2 id="email">Email</h2>
<ul>
<li>we need to set up an add-on that will take care of sending emails to voters - Heroku has a couple of third party add-ons that do this</li>
<li>on the Heroku dashboard page for your app go to the <strong>Resources</strong> tab and select <strong>Find more add-ons</strong></li>
<li>under <strong>Add-on categories</strong> go to <strong>Email/SMS</strong></li>
<li>select <strong>Mailgun</strong> (or Sendgrid, Trustifi, CloudMailin)</li>
<li>under <strong>Plans &amp; Pricing</strong> select <strong>Starter</strong> (the free option) and <strong>Install Mailgun</strong></li>
<li>to provision the add-on for your app enter the name of your app and click <strong>Submit Order Form</strong></li>
<li>check it has been added by going to the <strong>Settings</strong> page  - Config Vars should now include a number of keys relating to Mailgun</li>
<li>your email settings in settings.py should be:
<div class="language-shell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nv">EMAIL_HOST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;MAILGUN_SMTP_SERVER&#39;</span><span class="o">]</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nv">EMAIL_HOST_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;MAILGUN_SMTP_LOGIN&#39;</span><span class="o">]</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nv">EMAIL_HOST_PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;MAILGUN_SMTP_PASSWORD&#39;</span><span class="o">]</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nv">EMAIL_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">587</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="nv">EMAIL_USE_TLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span></code></pre></div></li>
<li>Mailgun places starting users in sandbox accounts which require email recipients to verify their email addresses (you can send an email to yourself without verification)</li>
<li>to add recipients, on the Heroku dashboard page for your app go to the <strong>Resources</strong> tab and click on the Mailgun add-on which will take you to your account on Mailgun</li>
<li>on the Mailgun dashbord, select the sandbox account</li>
<li>on the right there is a side-box where it is possible to add recipients</li>
<li>after a recipient is added, a confirmation email is automatically sent to the recipient who has to click an "I agree" button</li>
<li>following the changes to settings.py, commit and push to Github</li>
<li>go to the Heroku dashboard and, under Deploy, do a manual deploy if you have not set it up for automatic deploy</li>
<li>you should now be able to send emails to yourself and verified recipients from within Helios</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 10, 2025</span>
  </span>

    
    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>